<script lang="ts">
  export let language: "en" | "ja" = "en";

  interface Register {
    name: string;
    bits: number;
    purpose: string;
    purposeJa: string;
    commonUses: string[];
    commonUsesJa: string[];
    notes?: string;
    notesJa?: string;
  }

  const registers: Register[] = [
    {
      name: "RAX",
      bits: 64,
      purpose: "Accumulator Register",
      purposeJa: "ã‚¢ã‚­ãƒ¥ãƒ ãƒ¬ãƒ¼ã‚¿ãƒ¬ã‚¸ã‚¹ã‚¿",
      commonUses: [
        "Return value from functions",
        "Syscall number specification",
        "Arithmetic operations",
      ],
      commonUsesJa: [
        "é–¢æ•°ã®æˆ»ã‚Šå€¤",
        "ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç•ªå·ã®æŒ‡å®š",
        "ç®—è¡“æ¼”ç®—",
      ],
      notes: "Primary register for arithmetic and logic operations",
      notesJa: "ç®—è¡“æ¼”ç®—ã¨ãƒ­ã‚¸ãƒƒã‚¯æ¼”ç®—ã®ä¸»è¦ãƒ¬ã‚¸ã‚¹ã‚¿",
    },
    {
      name: "RBX",
      bits: 64,
      purpose: "Base Register",
      purposeJa: "ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿",
      commonUses: [
        "Base address for memory indexing",
        "General purpose storage",
      ],
      commonUsesJa: [
        "ãƒ¡ãƒ¢ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹",
        "æ±ç”¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸",
      ],
      notes: "Callee-saved (must preserve if used)",
      notesJa: "å‘¼ã³å‡ºã—å´ä¿å­˜ï¼ˆä½¿ç”¨æ™‚ã«ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼‰",
    },
    {
      name: "RCX",
      bits: 64,
      purpose: "Counter Register",
      purposeJa: "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ¬ã‚¸ã‚¹ã‚¿",
      commonUses: [
        "Loop counter",
        "String operations count",
        "Function argument (4th arg in System V ABI)",
      ],
      commonUsesJa: [
        "ãƒ«ãƒ¼ãƒ—ã‚«ã‚¦ãƒ³ã‚¿",
        "æ–‡å­—åˆ—æ“ä½œã‚«ã‚¦ãƒ³ãƒˆ",
        "é–¢æ•°å¼•æ•°ï¼ˆSystem V ABIã®ç¬¬4å¼•æ•°ï¼‰",
      ],
      notes: "Often used for loop control",
      notesJa: "ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡ã«é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹",
    },
    {
      name: "RDX",
      bits: 64,
      purpose: "Data Register",
      purposeJa: "ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¸ã‚¹ã‚¿",
      commonUses: [
        "I/O operations",
        "Division (quotient in RAX, remainder in RDX)",
        "Function argument (3rd arg in System V ABI)",
      ],
      commonUsesJa: [
        "I/Oæ“ä½œ",
        "é™¤ç®—ï¼ˆRAXã«å•†ã€RDXã«ä½™ã‚ŠãŒæ ¼ç´ï¼‰",
        "é–¢æ•°å¼•æ•°ï¼ˆSystem V ABIã®ç¬¬3å¼•æ•°ï¼‰",
      ],
      notes: "Extended for multiplication/division",
      notesJa: "ä¹—ç®—ãƒ»é™¤ç®—ç”¨ã«æ‹¡å¼µã•ã‚Œã‚‹",
    },
    {
      name: "RSI",
      bits: 64,
      purpose: "Source Index",
      purposeJa: "ã‚½ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹",
      commonUses: [
        "String source",
        "Function argument (2nd arg in System V ABI)",
        "Memory source address",
      ],
      commonUsesJa: [
        "æ–‡å­—åˆ—ã®ã‚½ãƒ¼ã‚¹",
        "é–¢æ•°å¼•æ•°ï¼ˆSystem V ABIã®ç¬¬2å¼•æ•°ï¼‰",
        "ãƒ¡ãƒ¢ãƒªã®ã‚½ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹",
      ],
      notes: "Commonly used for data source",
      notesJa: "ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹",
    },
    {
      name: "RDI",
      bits: 64,
      purpose: "Destination Index",
      purposeJa: "ãƒ‡ã‚¹ãƒ†ã‚£ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹",
      commonUses: [
        "String destination",
        "Function argument (1st arg in System V ABI)",
        "System call first argument",
      ],
      commonUsesJa: [
        "æ–‡å­—åˆ—ã®å®›å…ˆ",
        "é–¢æ•°å¼•æ•°ï¼ˆSystem V ABIã®ç¬¬1å¼•æ•°ï¼‰",
        "ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç¬¬1å¼•æ•°",
      ],
      notes: "Primary register for syscall arguments",
      notesJa: "ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«å¼•æ•°ã®ä¸»è¦ãƒ¬ã‚¸ã‚¹ã‚¿",
    },
    {
      name: "RBP",
      bits: 64,
      purpose: "Base Pointer",
      purposeJa: "ãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ã‚¿",
      commonUses: [
        "Stack frame base pointer",
        "Function local variable access",
      ],
      commonUsesJa: [
        "ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒ™ãƒ¼ã‚¹ãƒã‚¤ãƒ³ã‚¿",
        "é–¢æ•°ã®ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã‚¢ã‚¯ã‚»ã‚¹",
      ],
      notes: "Callee-saved, used for stack frame setup",
      notesJa: "å‘¼ã³å‡ºã—å´ä¿å­˜ã€ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ è¨­å®šã«ä½¿ç”¨",
    },
    {
      name: "RSP",
      bits: 64,
      purpose: "Stack Pointer",
      purposeJa: "ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿",
      commonUses: ["Stack top pointer", "Function return address storage"],
      commonUsesJa: ["ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒƒãƒ—ãƒã‚¤ãƒ³ã‚¿", "é–¢æ•°ã®æˆ»ã‚Šã‚¢ãƒ‰ãƒ¬ã‚¹æ ¼ç´"],
      notes: "Automatically managed by CALL/RET, do not manipulate directly",
      notesJa: "CALL/RETã§è‡ªå‹•ç®¡ç†ã€ç›´æ¥æ“ä½œã—ãªã„ã“ã¨",
    },
    {
      name: "R8-R15",
      bits: 64,
      purpose: "General Purpose Extended Registers",
      purposeJa: "æ±ç”¨æ‹¡å¼µãƒ¬ã‚¸ã‚¹ã‚¿",
      commonUses: [
        "Function arguments (R8-R11)",
        "General purpose operations",
      ],
      commonUsesJa: [
        "é–¢æ•°å¼•æ•°ï¼ˆR8-R11ï¼‰",
        "æ±ç”¨æ“ä½œ",
      ],
      notes: "Caller-saved (R8-R11), caller must preserve if needed",
      notesJa: "å‘¼ã³å‡ºã—å…ƒä¿å­˜ï¼ˆR8-R11ï¼‰ã€å¿…è¦ã«å¿œã˜ã¦ä¿å­˜",
    },
  ];

  const subRegisters = [
    {
      parent: "RAX",
      child: "EAX",
      bits: 32,
      description: "32-bit access to RAX (zeros upper 32 bits)",
      descriptionJa: "RAXã¸ã®32ãƒ“ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ï¼ˆä¸Šä½32ãƒ“ãƒƒãƒˆã¯ã‚¼ãƒ­ã«ãªã‚‹ï¼‰",
    },
    {
      parent: "RAX",
      child: "AX",
      bits: 16,
      description: "16-bit access to lower 16 bits of RAX",
      descriptionJa: "RAXã®ä¸‹ä½16ãƒ“ãƒƒãƒˆã¸ã®16ãƒ“ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹",
    },
    {
      parent: "RAX",
      child: "AL/AH",
      bits: 8,
      description: "8-bit access (AL=lower byte, AH=upper byte)",
      descriptionJa: "8ãƒ“ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ï¼ˆAL=ä¸‹ä½ãƒã‚¤ãƒˆã€AH=ä¸Šä½ãƒã‚¤ãƒˆï¼‰",
    },
  ];
</script>

<div class="register-reference">
  <h2 class="section-title">
    {language === "en" ? "General Purpose Registers" : "æ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿"}
  </h2>
  <p class="section-description">
    {language === "en"
      ? "x86_64 architecture provides 16 general-purpose 64-bit registers. Below is a guide to their primary purposes and common uses."
      : "x86_64ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯16å€‹ã®æ±ç”¨64ãƒ“ãƒƒãƒˆãƒ¬ã‚¸ã‚¹ã‚¿ã‚’æä¾›ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€ã“ã‚Œã‚‰ã®ä¸»ãªç”¨é€”ã¨ä¸€èˆ¬çš„ãªä½¿ç”¨æ–¹æ³•ã®ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚"}
  </p>

  <div class="registers-grid">
    {#each registers as reg (reg.name)}
      <div class="register-card">
        <div class="register-header">
          <h3 class="register-name">{reg.name}</h3>
          <span class="register-bits">{reg.bits} bits</span>
        </div>
        <div class="register-purpose">
          {language === "en" ? reg.purpose : reg.purposeJa}
        </div>
        <div class="register-uses">
          <strong>{language === "en" ? "Common Uses:" : "ä¸€èˆ¬çš„ãªç”¨é€”ï¼š"}</strong>
          <ul>
            {#each language === "en" ? reg.commonUses : reg.commonUsesJa as use}
              <li>{use}</li>
            {/each}
          </ul>
        </div>
        {#if language === "en" ? reg.notes : reg.notesJa}
          <div class="register-notes">
            <strong>{language === "en" ? "Note:" : "æ³¨è¨˜ï¼š"}</strong>
            {language === "en" ? reg.notes : reg.notesJa}
          </div>
        {/if}
      </div>
    {/each}
  </div>

  <h2 class="section-title" style="margin-top: 3rem;">
    {language === "en" ? "Sub-Register Access" : "ã‚µãƒ–ãƒ¬ã‚¸ã‚¹ã‚¿ã‚¢ã‚¯ã‚»ã‚¹"}
  </h2>
  <p class="section-description">
    {language === "en"
      ? "You can access parts of larger registers using different instruction suffixes. For example:"
      : "ç•°ãªã‚‹å‘½ä»¤ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€ã‚ˆã‚Šå¤§ããªãƒ¬ã‚¸ã‚¹ã‚¿ã®ä¸€éƒ¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚ä¾‹ï¼š"}
  </p>

  <div class="subregisters-table">
    <table>
      <thead>
        <tr>
          <th>{language === "en" ? "Parent Register" : "è¦ªãƒ¬ã‚¸ã‚¹ã‚¿"}</th>
          <th>{language === "en" ? "Sub-Register" : "ã‚µãƒ–ãƒ¬ã‚¸ã‚¹ã‚¿"}</th>
          <th>{language === "en" ? "Width" : "å¹…"}</th>
          <th>{language === "en" ? "Description" : "èª¬æ˜"}</th>
        </tr>
      </thead>
      <tbody>
        {#each subRegisters as sub}
          <tr>
            <td class="code">{sub.parent}</td>
            <td class="code highlight">{sub.child}</td>
            <td>{sub.bits}-bit</td>
            <td>{language === "en" ? sub.description : sub.descriptionJa}</td>
          </tr>
        {/each}
      </tbody>
    </table>
  </div>

  <div class="info-box">
    <strong>ğŸ’¡ {language === "en" ? "Tip:" : "ãƒ’ãƒ³ãƒˆï¼š"}</strong>
    {language === "en"
      ? "When you access a 32-bit register (e.g., EAX), the upper 32 bits of the 64-bit register (RAX) are automatically zeroed. This is useful for zero-extending values."
      : "32ãƒ“ãƒƒãƒˆãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆä¾‹ãˆã°EAXï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€64ãƒ“ãƒƒãƒˆãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆRAXï¼‰ã®ä¸Šä½32ãƒ“ãƒƒãƒˆãŒè‡ªå‹•çš„ã«ã‚¼ãƒ­ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚¼ãƒ­æ‹¡å¼µã«ä¾¿åˆ©ã§ã™ã€‚"}
  </div>
</div>

<style>
  .register-reference {
    width: 100%;
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #fff;
    margin: 0 0 0.5rem;
  }

  .section-description {
    color: #cbd5e1;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .registers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .register-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.2s;
  }

  .register-card:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(59, 130, 246, 0.4);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15);
  }

  .register-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 1rem;
    border-bottom: 2px solid rgba(59, 130, 246, 0.3);
    padding-bottom: 0.75rem;
  }

  .register-name {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 700;
    color: #60a5fa;
    font-family: "Fira Code", monospace;
  }

  .register-bits {
    background: rgba(59, 130, 246, 0.2);
    color: #93c5fd;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 600;
    font-family: "Fira Code", monospace;
  }

  .register-purpose {
    color: #94a3b8;
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 0.95rem;
  }

  .register-uses {
    margin-bottom: 1rem;
  }

  .register-uses strong {
    color: #cbd5e1;
    display: block;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .register-uses ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .register-uses li {
    color: #94a3b8;
    padding: 0.25rem 0 0.25rem 1.5rem;
    position: relative;
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .register-uses li::before {
    content: "â†’";
    position: absolute;
    left: 0;
    color: #3b82f6;
    font-weight: bold;
  }

  .register-notes {
    background: rgba(34, 197, 94, 0.1);
    border-left: 3px solid #22c55e;
    padding: 0.75rem;
    border-radius: 6px;
    font-size: 0.9rem;
    color: #d1fae5;
  }

  .register-notes strong {
    color: #10b981;
  }

  .subregisters-table {
    overflow-x: auto;
    margin-bottom: 2rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: "Fira Code", monospace;
    font-size: 0.9rem;
  }

  th {
    background: rgba(59, 130, 246, 0.1);
    color: #93c5fd;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid rgba(59, 130, 246, 0.3);
    font-weight: 600;
  }

  td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: #cbd5e1;
  }

  tbody tr:hover {
    background: rgba(255, 255, 255, 0.02);
  }

  .code {
    background: rgba(0, 0, 0, 0.3);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    color: #60a5fa;
    font-weight: 600;
  }

  .highlight {
    background: rgba(59, 130, 246, 0.2);
    color: #93c5fd;
  }

  .info-box {
    background: rgba(59, 130, 246, 0.1);
    border-left: 4px solid #3b82f6;
    padding: 1rem;
    border-radius: 8px;
    color: #cbd5e1;
    line-height: 1.6;
  }

  .info-box strong {
    color: #93c5fd;
  }
</style>
